<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>ZMUSIC MML Editor</title>
    <script src="dist/zmusic.js"></script>
    <script>
      // Utility function to load text files via XHR.
      function xhr(url) {
        return new Promise(function(resolve, reject) {
          var xhr = new XMLHttpRequest();
          xhr.open('GET', url, true);
          // Since MML code is in plain text, set the responseType to 'text'
          xhr.responseType = 'text';
          xhr.onload = function() {
            if (xhr.status === 200) {
              resolve(xhr.responseText);
            } else {
              reject(new Error('Error: ' + xhr.status));
            }
          };
          xhr.onerror = function(e) {
            reject(e);
          };
          xhr.send();
        });
      }

      // Global variable to hold the default MML code.
      var defaultMml = "";

      // Install ZMUSIC and load the default MML code.
      Promise.all([
        ZMUSIC.install(),
        xhr('data/bgm1.zms')
      ]).then(function(results) {
        defaultMml = results[1];
        // Insert the default MML code into the textarea.
        document.getElementById("mml-editor").value = defaultMml;
      }).catch(function(err) {
        console.error("Error during initialization:", err);
      });

      // Function to retrieve the MML code from the textarea and play it.
      function playMml() {
        var mmlCode = document.getElementById("mml-editor").value;
        ZMUSIC.compileAndPlay(mmlCode);
      }
    </script>
  </head>
  <body>
    <h1>ZMUSIC MML Editor</h1>
    <!-- Text area for writing or modifying MML code -->
    <textarea id="mml-editor" rows="15" cols="60"></textarea>
    <br>
    <!-- Play the MML code -->
    <button onclick="playMml()">Play</button>
    <!-- Unmute button if required -->
    <button onclick="ZMUSIC.resume()">Unmute</button>
  </body>
</html>
