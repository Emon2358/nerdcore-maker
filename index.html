<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <title>ZMUSIC 再生テスト</title>
    <!-- ZMUSIC のライブラリ読み込み -->
    <script src="dist/zmusic.js"></script>
    <script>
      // XHR ユーティリティ: URL から ArrayBuffer を取得する
      function xhr(url) {
        return new Promise((resolve, reject) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', url, true);
          xhr.responseType = 'arraybuffer';
          xhr.addEventListener('load', () => {
            if (xhr.status === 200) {
              resolve(xhr.response);
            } else {
              reject(new Error('Failed to load ' + url));
            }
            xhr.abort();
          });
          xhr.send();
        });
      }

      // 再生ボタンがクリックされたときに実行する処理
      async function playMusic() {
        // ユーザー操作で AudioContext を再開
        if (window.ZMUSIC && ZMUSIC && ZMUSIC.resume) {
          ZMUSIC.resume();
        }
        try {
          const [_, zms] = await Promise.all([
            ZMUSIC.install(),
            xhr('./test.zms')
          ]);
          ZMUSIC.play(zms);
        } catch (e) {
          console.error("エラーが発生しました:", e);
        }
      }
    </script>
  </head>
  <body>
    <h1>ZMUSIC 再生テスト</h1>
    <!-- 再生するボタン -->
    <button onclick="playMusic()">再生する</button>
  </body>
</html>
